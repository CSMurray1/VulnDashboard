<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Vulnerability Dashboard</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸª²</text></svg>" />

<style>
:root {
  --bg-light: #f8f9fa;
  --text-light: #212529;
  --panel-light: #ffffff;
  --border-light: #dee2e6;
  --link-light: #0d6efd;
  --bg-dark: #121212;
  --text-dark: #e9ecef;
  --panel-dark: #1e1e1e;
  --border-dark: #343a40;
  --link-dark: #8ab4f8;
  --input-bg-dark: #2d2d2d;
  --input-text-dark: #e9ecef;
}

body {
  font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
  margin: 0;
  background: var(--bg-light);
  color: var(--text-light);
  line-height: 1.6;
}
body.dark {
  background: var(--bg-dark);
  color: var(--text-dark);
}
a { color: var(--link-light); text-decoration: none; }
body.dark a { color: var(--link-dark); }
a:hover { text-decoration: underline; }

nav {
  display: flex;
  justify-content: center;
  background: #444;
  color: white;
}
nav button {
  flex: 1;
  padding: 14px;
  font-size: 16px;
  color: white;
  background: #444;
  border: none;
  cursor: pointer;
}
nav button.active { background: #0074d9; }

.mode {
  position: fixed;
  top: 14px;
  right: 14px;
  padding: 8px 16px;
  background: #ddd;
  border: 1px solid #ccc;
  border-radius: 5px;
  cursor: pointer;
  z-index: 1000;
}
body.dark .mode {
  background: #444;
  color: white;
  border-color: #666;
}

header.cve-header {
  padding: 20px;
  border-bottom: 1px solid var(--border-light);
  display: flex;
  gap: 12px;
  align-items: center;
  flex-wrap: wrap;
  position: sticky;
  top: 0;
  background: inherit;
  z-index: 10;
}
body.dark header.cve-header { border-color: var(--border-dark); }

#cve {
  flex: 1;
  min-width: 300px;
  padding: 12px;
  font-size: 16px;
  border: 1px solid var(--border-light);
  border-radius: 6px;
}
body.dark #cve { background: var(--input-bg-dark); border-color: var(--border-dark); color: white; }

.btn {
  padding: 10px 16px;
  background: var(--panel-light);
  border: 1px solid var(--border-light);
  border-radius: 6px;
  cursor: pointer;
}
body.dark .btn {
  background: var(--panel-dark);
  border-color: var(--border-dark);
  color: white;
}

main.cve-main {
  padding: 20px;
  display: grid;
  gap: 20px;
  grid-template-columns: 1fr 1fr 320px;
  grid-template-areas:
    "details details watch"
    "sources relevant vulncheck";
}

.panel {
  background: var(--panel-light);
  border: 1px solid var(--border-light);
  border-radius: 8px;
}
body.dark .panel { background: var(--panel-dark); border-color: var(--border-dark); }

.content { padding: 16px; }

#toast, #loading {
  position: fixed;
  background: rgba(0,0,0,0.8);
  color: white;
  padding: 12px 24px;
  border-radius: 8px;
  z-index: 2000;
}
#toast { bottom: 30px; left: 50%; transform: translateX(-50%); display: none; }
#loading { inset: 0; display: none; align-items: center; justify-content: center; }

#attackModal {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.7);
  z-index: 1100;
  align-items: center;
  justify-content: center;
}
#attackModal > div {
  background: white;
  padding: 20px;
  border-radius: 8px;
  width: 90%;
  max-width: 1000px;
  position: relative;
}
body.dark #attackModal > div { background: #222; color: white; }

#watcher {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.7);
  z-index: 1300;
  align-items: center;
  justify-content: center;
}
.watcher-content {
  background: white;
  padding: 24px;
  border-radius: 8px;
  width: 90%;
  max-width: 500px;
}
body.dark .watcher-content { background: #222; color: white; }
</style>
</head>
<body>

<button class="mode">Dark Mode</button>

<nav>
  <button class="active">CVE Dashboard</button>
  <button>CyberWatch Dashboard</button>
</nav>

<header class="cve-header">
  <h1>Vulnerability Dashboard</h1>
  <input id="cve" placeholder="CVE-2021-44228" />
  <button id="go" class="btn">Run</button>
  <button id="watcherBtn" class="btn">CVE Watcher</button>
</header>

<main class="cve-main">
  <div class="panel" id="cveDetails">
    <div class="content" id="cveContent">Enter a CVE and click Run</div>
  </div>
  <!-- Add your other panels here if needed -->
</main>

<div id="loading">Loading...</div>
<div id="toast"></div>

<!-- Attack Modal -->
<div id="attackModal">
  <div>
    <button id="closeModal">Close</button>
    <div id="attackGraph">Attack path visualization placeholder</div>
  </div>
</div>

<!-- Watcher Modal -->
<div id="watcher">
  <div class="watcher-content">
    <h2>CVE Watcher</h2>
    <textarea id="watcherList" rows="6" placeholder="CVE-2024-XXXX\nCVE-2025-YYYY"></textarea>
    <button id="watcherClose" class="btn">Close</button>
  </div>
</div>

<script>
// Helpers
function toast(msg) {
  const t = document.getElementById("toast");
  t.textContent = msg;
  t.style.display = "block";
  setTimeout(() => t.style.display = "none", 3000);
}

function toggleMode() {
  document.body.classList.toggle("dark");
  document.querySelector(".mode").textContent = document.body.classList.contains("dark") ? "Light Mode" : "Dark Mode";
}

// CVE Search
async function runSearch() {
  const input = document.getElementById("cve").value.trim().toUpperCase();
  if (!/^CVE-\d{4}-\d{4,}$/.test(input)) {
    toast("Please enter a valid CVE");
    return;
  }

  document.getElementById("loading").style.display = "flex";

  try {
    const res = await fetch(`https://cveawg.mitre.org/api/cve/${input}`);
    if (!res.ok) throw new Error("CVE not found");
    const data = await res.json();

    const desc = data?.containers?.cna?.descriptions?.[0]?.value || "No description available";

    document.getElementById("cveContent").innerHTML = `
      <h3>${input}</h3>
      <p>${desc}</p>
      <button id="openAttack">Show Attack Path</button>
    `;

    // Safe event attachment
    const attackBtn = document.getElementById("openAttack");
    if (attackBtn) {
      attackBtn.onclick = () => {
        document.getElementById("attackModal").style.display = "flex";
      };
    }

  } catch (err) {
    document.getElementById("cveContent").innerHTML = `Error: ${err.message}`;
  } finally {
    document.getElementById("loading").style.display = "none";
  }
}

// Event listeners
document.addEventListener("DOMContentLoaded", () => {
  document.querySelector(".mode").onclick = toggleMode;

  document.getElementById("go").onclick = runSearch;
  document.getElementById("cve").onkeydown = (e) => {
    if (e.key === "Enter") {
      e.preventDefault();
      runSearch();
    }
  };

  document.getElementById("closeModal").onclick = () => {
    document.getElementById("attackModal").style.display = "none";
  };

  document.getElementById("watcherBtn").onclick = () => {
    document.getElementById("watcher").style.display = "flex";
  };

  document.getElementById("watcherClose").onclick = () => {
    document.getElementById("watcher").style.display = "none";
  };
});
</script>
</body>
</html>
